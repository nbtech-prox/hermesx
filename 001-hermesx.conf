<VirtualHost *:80>
        # Definir prioridade alta para este VirtualHost
        ServerName hermesx.nbserver.pt
        ServerAlias www.hermesx.nbserver.pt
        ServerAdmin nbtech.prox@gmail.com

        DocumentRoot /var/www/html/hermesx

        # Configuração básica do Cloudflare
        SetEnvIf X-Forwarded-Proto https HTTPS=on

        # Configuração WSGI
        WSGIDaemonProcess hermesx python-path=/var/www/html/hermesx:/var/www/html/hermesx/env/lib/python3.10/site-packages
        WSGIProcessGroup hermesx
        WSGIScriptAlias / /var/www/html/hermesx/run.wsgi

        # Garantir que este VirtualHost só responda ao domínio correto
        <DirectoryMatch "^/var/www/html/hermesx/">
                Require all granted
                Options FollowSymLinks
                AllowOverride None

                # Restringir acesso apenas ao domínio correto
                <RequireAll>
                        Require all granted
                        Require expr %{HTTP_HOST} == 'hermesx.nbserver.pt' || %{HTTP_HOST} == 'www.hermesx.nbserver.pt'
                </RequireAll>
        </DirectoryMatch>

        # Proteção de diretórios sensíveis
        <Directory /var/www/html/hermesx/.git>
                Require all denied
        </Directory>

        <Directory /var/www/html/hermesx/.env>
                Require all denied
        </Directory>

        <FilesMatch "\.(py|pyc|ini|log)$">
                Require all denied
        </FilesMatch>

        <Location /static>
                Require all granted
        </Location>

        ErrorLog ${APACHE_LOG_DIR}/hermesx_error.log
        CustomLog ${APACHE_LOG_DIR}/hermesx_access.log combined
</VirtualHost>
